<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kevin Jablonka">
<meta name="dcterms.date" content="2024-04-24">

<title>Lamalab Tool and Paper Notes - Uncertainty-Aware Yield Prediction with Multimodal Molecular Features</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../papers/dagdelen_data_extraction.html" rel="next">
<link href="../papers/llm4mat.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background-image: url(chen_yield_pred_2024_images/dalle_yield.webp);
background-size: cover;
      }
</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../papers/llm4mat.html">Papers</a></li><li class="breadcrumb-item"><a href="../papers/chem_yield_prediction_2024.html"><span class="chapter-title">Uncertainty-Aware Yield Prediction with Multimodal Molecular Features</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../papers/llm4mat.html">Papers</a></li><li class="breadcrumb-item"><a href="../papers/chem_yield_prediction_2024.html"><span class="chapter-title">Uncertainty-Aware Yield Prediction with Multimodal Molecular Features</span></a></li></ol></nav>
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><span class="chapter-title">Uncertainty-Aware Yield Prediction with Multimodal Molecular Features</span></h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Kevin Jablonka </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 24, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Lamalab Tool and Paper Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Tool and paper minutes</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/hydra.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Hydra</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/ip_rotator.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">IP Rotator</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/polars.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Polars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/thunder_client.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Thunder Client</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/tmux.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">tmux</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/trimean.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Robust statistics and Trimean</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/pandarallel.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Easy fast <code>.apply</code> for pandas</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/bfg.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">BFG Repo-Cleaner</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../tools/showyourwork.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">showyourwork</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Papers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../papers/llm4mat.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Leveraging language representation for materials exploration and discovery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../papers/chem_yield_prediction_2024.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Uncertainty-Aware Yield Prediction with Multimodal Molecular Features</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../papers/dagdelen_data_extraction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Structured information extraction from scientific text with large language models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../papers/MolCLR_2024.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Molecular contrastive learning of representations (MolCLR) via graph neural networks</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-discussing-this-paper" id="toc-why-discussing-this-paper" class="nav-link active" data-scroll-target="#why-discussing-this-paper">Why discussing this paper?</a></li>
  <li><a href="#context" id="toc-context" class="nav-link" data-scroll-target="#context">Context</a></li>
  <li><a href="#prior-work" id="toc-prior-work" class="nav-link" data-scroll-target="#prior-work">Prior work</a>
  <ul class="collapse">
  <li><a href="#ahneman-et-al.-2018" id="toc-ahneman-et-al.-2018" class="nav-link" data-scroll-target="#ahneman-et-al.-2018">Ahneman et al.&nbsp;(2018)</a></li>
  <li><a href="#schwaller-et-al.-2020-2021" id="toc-schwaller-et-al.-2020-2021" class="nav-link" data-scroll-target="#schwaller-et-al.-2020-2021">Schwaller et al.&nbsp;(2020, 2021)</a></li>
  <li><a href="#kwon-et-al.-2022" id="toc-kwon-et-al.-2022" class="nav-link" data-scroll-target="#kwon-et-al.-2022">Kwon et al.&nbsp;(2022)</a></li>
  </ul></li>
  <li><a href="#problem-setting" id="toc-problem-setting" class="nav-link" data-scroll-target="#problem-setting">Problem setting</a></li>
  <li><a href="#approach" id="toc-approach" class="nav-link" data-scroll-target="#approach">Approach</a>
  <ul class="collapse">
  <li><a href="#graph-encoder-and-smiles-encoder" id="toc-graph-encoder-and-smiles-encoder" class="nav-link" data-scroll-target="#graph-encoder-and-smiles-encoder">Graph encoder and SMILES encoder</a></li>
  <li><a href="#human-features-encoder" id="toc-human-features-encoder" class="nav-link" data-scroll-target="#human-features-encoder">Human-features encoder</a></li>
  <li><a href="#fusion" id="toc-fusion" class="nav-link" data-scroll-target="#fusion">Fusion</a></li>
  <li><a href="#uncertainty-quantification" id="toc-uncertainty-quantification" class="nav-link" data-scroll-target="#uncertainty-quantification">Uncertainty (quantification)</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a>
  <ul class="collapse">
  <li><a href="#ablations" id="toc-ablations" class="nav-link" data-scroll-target="#ablations">Ablations</a></li>
  </ul></li>
  <li><a href="#take-aways" id="toc-take-aways" class="nav-link" data-scroll-target="#take-aways">Take aways</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="why-discussing-this-paper" class="level2">
<h2 class="anchored" data-anchor-id="why-discussing-this-paper">Why discussing this paper?</h2>
<p>I chose Chen et al.’s paper <span class="citation" data-cites="Chen_2024">(<a href="#ref-Chen_2024" role="doc-biblioref">Chen et al. 2024</a>)</span> for our journal club because</p>
<ul>
<li>An important and interesting problem in chemistry</li>
<li>Uses many of the techniques we care about in our group</li>
</ul>
</section>
<section id="context" class="level2">
<h2 class="anchored" data-anchor-id="context">Context</h2>
<p>Predicting the yield of chemical reactions is a crucial task in organic chemistry. It can help to optimize the synthesis of new molecules, reduce the number of experiments needed, and save time and resources. However, predicting the yield of a reaction is challenging due to the complexity of chemical reactions and the large number of factors that can influence the outcome.</p>
</section>
<section id="prior-work" class="level2">
<h2 class="anchored" data-anchor-id="prior-work">Prior work</h2>
<section id="ahneman-et-al.-2018" class="level3">
<h3 class="anchored" data-anchor-id="ahneman-et-al.-2018">Ahneman et al.&nbsp;(2018)</h3>
<p>Ahneman et al. <span class="citation" data-cites="Ahneman_2018">(<a href="#ref-Ahneman_2018" role="doc-biblioref">Ahneman et al. 2018</a>)</span> reported in <em>Science</em> a random forest model that predicts the yield of chemical reactions in a high-throughput dataset (palladium-catalyzed Buchwald-Hartwig cross-coupling reactions). For this, the authors created a set of features using computational techniques.</p>
<p>A very interesting aspect of this work is the subsequent exchange with Chuang and Keiser <span class="citation" data-cites="Chuang_2018">(<a href="#ref-Chuang_2018" role="doc-biblioref">Chuang and Keiser 2018</a>)</span> who point out that the chemical features used in the work by Ahneman et al.&nbsp;perform not distinguishably better than non-meaningful features.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chen_yield_pred_2024_images/362_aat8603_f1.jpeg" class="img-fluid figure-img"></p>
<figcaption>Figure taken from Chuang and Keiser’s paper<span class="citation" data-cites="Chuang_2018">(<a href="#ref-Chuang_2018" role="doc-biblioref">Chuang and Keiser 2018</a>)</span> illustrating models trained with various featurization approaches.</figcaption>
</figure>
</div>
</section>
<section id="schwaller-et-al.-2020-2021" class="level3">
<h3 class="anchored" data-anchor-id="schwaller-et-al.-2020-2021">Schwaller et al.&nbsp;(2020, 2021)</h3>
<p>Schwaller et al. <span class="citation" data-cites="schwaller2020data schwaller2021prediction">(<a href="#ref-schwaller2020data" role="doc-biblioref">Schwaller et al. 2020</a>, <a href="#ref-schwaller2021prediction" role="doc-biblioref">2021</a>)</span> utilized BERT models with a regression head to predict yields based on reaction SMILES.</p>
<p>They observed multiple interesting effects:</p>
<ul>
<li>The performance on high-throughput datasets is good, on USPTO datasets the models are not predictive (<span class="math inline">\(R^2\)</span> on a random split of 0.117 for the gram scale)</li>
<li>The yield distribution depends on the scale, which might be due to reaction at larger scale being better optimized</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chen_yield_pred_2024_images/yield_scales.jpg" class="img-fluid figure-img"></p>
<figcaption>Figure taken from Schwaller et al. <span class="citation" data-cites="schwaller2021prediction">(<a href="#ref-schwaller2021prediction" role="doc-biblioref">Schwaller et al. 2021</a>)</span> illustrating the distribution of yields on different scales.</figcaption>
</figure>
</div>
</section>
<section id="kwon-et-al.-2022" class="level3">
<h3 class="anchored" data-anchor-id="kwon-et-al.-2022">Kwon et al.&nbsp;(2022)</h3>
<p>Kwon et al. <span class="citation" data-cites="Kwon_2022">(<a href="#ref-Kwon_2022" role="doc-biblioref">Kwon et al. 2022</a>)</span>, in contrast, used graph neural networks to predict yields. They pass reactants and products through a graph neural network and concatenate the embeddings to predict the yield. They train on a similar loss as the work at hand (but use also use dropout Monte-Carlo <span class="citation" data-cites="gal2016dropout">(<a href="#ref-gal2016dropout" role="doc-biblioref">Gal and Ghahramani 2016</a>)</span> to estimate the epistemic uncertainty).</p>
</section>
</section>
<section id="problem-setting" class="level2">
<h2 class="anchored" data-anchor-id="problem-setting">Problem setting</h2>
<ul>
<li>prior works perform well on high-throughput datasets but not on real-world datasets</li>
<li>this is partially due to a lot of noise in datasets</li>
<li>of course, reaction conditions are important, too</li>
</ul>
<p>Additionally, the authors propose that the previous representations might not be “rich” enough to capture the complexity of chemical reactions.</p>
</section>
<section id="approach" class="level2">
<h2 class="anchored" data-anchor-id="approach">Approach</h2>
<p>The authors propose to fuse multiple features. In addition, they also use a special loss function and a mixture of experts (MoE) model used to transform human-designed features.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="chen_yield_pred_2024_images/approach.png" class="img-fluid figure-img"></p>
<figcaption>Overview of the model architecture. Figure taken from Chem et al. <span class="citation" data-cites="Chen_2024">(<a href="#ref-Chen_2024" role="doc-biblioref">Chen et al. 2024</a>)</span></figcaption>
</figure>
</div>
<section id="graph-encoder-and-smiles-encoder" class="level3">
<h3 class="anchored" data-anchor-id="graph-encoder-and-smiles-encoder">Graph encoder and SMILES encoder</h3>
<p>The authors pretrain the graph and SMILES encoders using a contrastive loss. The graph encoder is a GNN, the SMILES encoder is a transformer.</p>
<section id="graph-convolutional-neural-network" class="level4">
<h4 class="anchored" data-anchor-id="graph-convolutional-neural-network">Graph convolutional neural network</h4>
<p>Their graph encoder is basically a message graph convolutional neural network. The authors use the <code>DGL</code> library to <a href="https://github.com/jychen229/reaction-yield-prediction/blob/main/model.py#L237">implement this</a>.</p>
<p>The forward pass looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(<span class="va">self</span>.num_step_message_passing):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    node_feats <span class="op">=</span> <span class="va">self</span>.activation(<span class="va">self</span>.gnn_layer(g, node_feats, edge_feats)).unsqueeze(<span class="dv">0</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    node_feats, hidden_feats <span class="op">=</span> <span class="va">self</span>.gru(node_feats, hidden_feats)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    node_feats <span class="op">=</span> node_feats.squeeze(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Where the GNN layer performs a simple operation such as</p>
<p><span class="math display">\[
\mathbf{x}_i^{\prime}=\boldsymbol{\Theta}^{\top} \sum_{j \in \mathcal{N}(i) \cup\{i\}} \frac{e_{j, i}}{\sqrt{\hat{d}_j \hat{d}_i}} \mathbf{x}_j
\]</span></p>
<p>where <span class="math inline">\(\hat{d}_i\)</span> is the degree of node <span class="math inline">\(i\)</span> and <span class="math inline">\(\boldsymbol{\Theta}\)</span> is a learnable weight matrix. <span class="math inline">\(\mathcal{N}(i)\)</span> is the set of neighbors of node <span class="math inline">\(i\)</span>. <span class="math inline">\(\mathbf{x}_i\)</span> is the node embedding of node <span class="math inline">\(i\)</span>, <span class="math inline">\(e_{j, i}\)</span> is the edge feature between node <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>.</p>
<p>The node embeddings are then aggregated using Set2Set pooling <span class="citation" data-cites="vinyals2016order">(<a href="#ref-vinyals2016order" role="doc-biblioref">Vinyals, Bengio, and Kudlur 2016</a>)</span>.</p>
</section>
<section id="smiles-encoder" class="level4">
<h4 class="anchored" data-anchor-id="smiles-encoder">SMILES encoder</h4>
<p>For encoding SMILES, the use a transformer model. <a href="https://github.com/jychen229/reaction-yield-prediction/blob/main/model.py#L237">In their code</a>, they seem to pass through only one transformer layer.</p>
<p>The forward pass looks like this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="va">self</span>.token_embedding(text)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x <span class="op">+</span> <span class="va">self</span>.positional_embedding</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x.permute(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)  <span class="co"># NLD -&gt; LND</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="va">self</span>.transformer(x)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x.permute(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>)  <span class="co"># LND -&gt; NLD</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="va">self</span>.ln_final(x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="va">self</span>.pooler(x[:,<span class="dv">0</span>,:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>They take the first token of the sequence and pass it through a linear layer to get the final representation.</p>
</section>
<section id="contrastive-training" class="level4">
<h4 class="anchored" data-anchor-id="contrastive-training">Contrastive training</h4>
<p>The authors use a contrastive loss to train the encoders.</p>
<p><span class="math display">\[
\mathcal{L}_c=-\frac{1}{2} \log \frac{e^{\left\langle f_G^j, f_S^j\right\rangle / \tau}}{\sum_{k=1}^N e^{\left\langle f_G^j, f_S^k\right\rangle / \tau}}-\frac{1}{2} \log \frac{e^{\left\langle f_G^j, f_S^j\right\rangle / \tau}}{\sum_{k=1}^N e^{\left\langle f_G^k, f_S^j\right\rangle / \tau}},
\]</span></p>
<p>In contrastive training, we try to maximize the similarity between positive pairs and minimize the similarity between negative pairs. In the equation above, <span class="math inline">\(f_G^j\)</span> and <span class="math inline">\(f_S^j\)</span> are the representations of the graph and SMILES of the same reaction, respectively. <span class="math inline">\(\tau\)</span> is a temperature parameter.</p>
<p>Such contrastive training allows to pretrain the encoders on a large dataset without labels.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Contrastive learning is one of the most popular methods in self-supervised learning. A good overview can be found in <a href="https://lilianweng.github.io/posts/2021-05-31-contrastive/">Lilian Weng’s amazing blog</a>.</p>
</div>
</div>
</section>
</section>
<section id="human-features-encoder" class="level3">
<h3 class="anchored" data-anchor-id="human-features-encoder">Human-features encoder</h3>
<p>The authors also encode additional features with feedforward networks in a mixture of experts (MoE) model. The key idea behind MoE is that we replace “conventional layers” with “MoE layers” which are copies of the same layer. A gating network decides, based on the input, which layer to use. This is powerful if we sparsely select the experts-then only a subset of all weights are used in a given forward pass.</p>
<p><span class="math display">\[
\operatorname{MoE}\left(x_H\right)=\sum_{i=1}^t \mathcal{G}\left(x_H\right)_i \cdot E_i\left(x_H\right)
\]</span></p>
<p>This is a mixture of experts model. The authors use a gating network <span class="math inline">\(\mathcal{G}\)</span> to decide which expert to use. The experts <span class="math inline">\(E_i\)</span> are simple feedforward networks. The gating network might be a simple softmax layer:</p>
<p><span class="math display">\[
G_\sigma(x)=\operatorname{Softmax}\left(x \cdot W_g\right)
\]</span></p>
<p>in practice, one can improve that by adding sparsity (e.g.&nbsp;selecting top-k).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>MoE <span class="citation" data-cites="shazeer2017outrageously">(<a href="#ref-shazeer2017outrageously" role="doc-biblioref">Shazeer et al. 2017</a>)</span> has become popular recently as a way to scale LLMs. You might have across model names like Mixtral-8x7B <span class="citation" data-cites="jiang2024mixtral">(<a href="#ref-jiang2024mixtral" role="doc-biblioref">Jiang et al. 2024</a>)</span>, which indicates that the model is a mixture of 8 experts, each of which is a 7B parameter model. The total number of parameters is 47B parameters, but the inference cost is similar to the one of a 14B parameter model. (Note however, that memory consumption is still high as all experts need to be loaded into memory.)</p>
<p><a href="https://cameronrwolfe.substack.com/p/conditional-computation-the-birth">This blog by Cameron Wolfe</a> gives a good overview. You might also find <a href="https://www.youtube.com/watch?v=mwO6v4BlgZQ">Yannic Kilcher’s video about Mixtral of Experts</a> useful.</p>
</div>
</div>
</section>
<section id="fusion" class="level3">
<h3 class="anchored" data-anchor-id="fusion">Fusion</h3>
<p>The fusion of the different features is done by concatenating them</p>
<p>The complete forward pass looks like this:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>r_graph_feats <span class="op">=</span> torch.<span class="bu">sum</span>(torch.stack([<span class="va">self</span>.clme.mpnn(mol) <span class="cf">for</span> mol <span class="kw">in</span> rmols]), <span class="dv">0</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>p_graph_feats <span class="op">=</span> <span class="va">self</span>.clme.mpnn(pmols)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>feats, a_loss <span class="op">=</span> <span class="va">self</span>.mlp(input_feats)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>seq_feats <span class="op">=</span> <span class="va">self</span>.clme.transformer(smiles)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>concat_feats <span class="op">=</span> torch.cat([r_graph_feats, p_graph_feats, feats, seq_feats], <span class="dv">1</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> <span class="va">self</span>.predict(concat_feats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where the <code>mpnn</code> method is the graph encoder, the <code>transformer</code> method is the SMILES encoder, and the <code>mlp</code> method is the human-features encoder.</p>
</section>
<section id="uncertainty-quantification" class="level3">
<h3 class="anchored" data-anchor-id="uncertainty-quantification">Uncertainty (quantification)</h3>
<p>The authors define the prediction as</p>
<p><span class="math display">\[
\hat{y}=\mu(\boldsymbol{x})+\epsilon * \sigma(\boldsymbol{x})
\]</span></p>
<p>where <span class="math inline">\(\mu(\boldsymbol{x})\)</span> is the prediction, <span class="math inline">\(\sigma(\boldsymbol{x})\)</span> is the uncertainty, and <span class="math inline">\(\epsilon\)</span> is a random variable sampled from a normal distribution.</p>
<p>The model is trained with a loss function that includes the uncertainty:</p>
<p><span class="math display">\[
\mathcal{L}_u=\frac{1}{N} \sum_{i=1}^N\left[\frac{1}{\sigma\left(\boldsymbol{x}_i\right)^2}\left\|y_i-\mu\left(\boldsymbol{x}_i\right)\right\|^2+\log \sigma\left(\boldsymbol{x}_i\right)^2\right]
\]</span></p>
<p>The <span class="math inline">\(\sigma\)</span> term is capturing observation noise (aleatoric uncertainty).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>This loss comes from the idea of variational inference.</p>
<p><span class="math display">\[
\mathcal{L}(\boldsymbol{\lambda})=-\mathbb{E}_{q(\boldsymbol{\theta} ; \boldsymbol{\lambda})}[\log p(\mathbf{y} \mid \mathbf{x}, \boldsymbol{\theta})]+\mathrm{KL}(q(\boldsymbol{\theta} ; \boldsymbol{\lambda}) \| p(\boldsymbol{\theta}))
\]</span></p>
<p>In this equation, the first term is the negative log-likelihood, and the second term is the KL divergence between the approximate posterior <span class="math inline">\(q(\boldsymbol{\theta} ; \boldsymbol{\lambda})\)</span> and the prior <span class="math inline">\(p(\boldsymbol{\theta})\)</span>. The KL divergence is a measure of how much the approximate posterior diverges from the prior. The idea is to minimize the negative log-likelihood while keeping the approximate posterior close to the prior. This is a way to quantify the uncertainty in the model.</p>
<p>The idea comes from Bayesian inference, where we want to estimate the posterior distribution over the parameters of the model. In practice, this is intractable, so we use variational inference to approximate the posterior with a simpler distribution. The posterior (which quantifies uncertainty) is typically computationally expensive to compute, so we use variational inference to approximate it with a simpler distribution, this is called variational inference. Since during training, we do some sampling, we need to perform a reparametrization trick <span class="citation" data-cites="kingma2015variational">(<a href="#ref-kingma2015variational" role="doc-biblioref">Kingma, Salimans, and Welling 2015</a>)</span> to make the gradients flow through the sampling operation.</p>
</div>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>As in most ML papers, we have tables with bold numbers, e.g.&nbsp;for a dataset with amide coupling reactions:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: center;">MAE <span class="math inline">\(\downarrow\)</span></th>
<th style="text-align: center;">RMSE <span class="math inline">\(\downarrow\)</span></th>
<th style="text-align: center;"><span class="math inline">\(R^2 \uparrow\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Mordred</td>
<td style="text-align: center;"><span class="math inline">\(15.99 \pm 0.14\)</span></td>
<td style="text-align: center;"><span class="math inline">\(21.08 \pm 0.16\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.168 \pm 0.010\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">YieldBert</td>
<td style="text-align: center;"><span class="math inline">\(16.52 \pm 0.20\)</span></td>
<td style="text-align: center;"><span class="math inline">\(21.12 \pm 0.13\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.172 \pm 0.016\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">YieldGNN</td>
<td style="text-align: center;"><span class="math inline">\(\underline{15.27 \pm 0.18}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\underline{19.82} \pm 0.08\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\underline{0.216} \pm 0.013\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">MPNN</td>
<td style="text-align: center;"><span class="math inline">\(16.31 \pm 0.22\)</span></td>
<td style="text-align: center;"><span class="math inline">\(20.86 \pm 0.27\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.188 \pm 0.021\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ours</td>
<td style="text-align: center;"><span class="math inline">\(\mathbf{1 4 . 7 6} \pm \mathbf{0 . 1 5}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mathbf{1 9 . 3 3} \pm \mathbf{0 . 1 0}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\mathbf{0 . 2 6 2} \pm \mathbf{0 . 0 0 9}\)</span></td>
</tr>
</tbody>
</table>
<p>Here, their model outperforms the baselines. But it is also interesting to see how well the Mordred baseline performs compared to much more complex models.</p>
<p>The pattern of their model being bold in tables is persistent across datasets.</p>
<section id="ablations" class="level3">
<h3 class="anchored" data-anchor-id="ablations">Ablations</h3>
<p>The authors perform ablations to understand the importance of the different components of their model. While there are some differences, the differences are not drastic (partially overlapping errorbars).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 26%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: center;">MAE <span class="math inline">\(\downarrow\)</span></th>
<th style="text-align: center;">RMSE <span class="math inline">\(\downarrow\)</span></th>
<th style="text-align: center;"><span class="math inline">\(R^2 \uparrow\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ours</td>
<td style="text-align: center;"><span class="math inline">\(14.76 \pm 0.15\)</span></td>
<td style="text-align: center;"><span class="math inline">\(19.33 \pm 0.10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.262 \pm 0.009\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">w/o UQ</td>
<td style="text-align: center;"><span class="math inline">\(15.08 \pm 0.13\)</span></td>
<td style="text-align: center;"><span class="math inline">\(19.63 \pm 0.09\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.249 \pm 0.009\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">w/o <span class="math inline">\(\mathcal{L}_r\)</span></td>
<td style="text-align: center;"><span class="math inline">\(14.80 \pm 0.16\)</span></td>
<td style="text-align: center;"><span class="math inline">\(19.51 \pm 0.10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.261 \pm 0.010\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">w/o MoE</td>
<td style="text-align: center;"><span class="math inline">\(15.12 \pm 0.18\)</span></td>
<td style="text-align: center;"><span class="math inline">\(20.03 \pm 0.13\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.230 \pm 0.012\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">w/o Seq.</td>
<td style="text-align: center;"><span class="math inline">\(14.97 \pm 0.16\)</span></td>
<td style="text-align: center;"><span class="math inline">\(19.55 \pm 0.11\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.261 \pm 0.010\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">w/o Graph</td>
<td style="text-align: center;"><span class="math inline">\(15.06 \pm 0.15\)</span></td>
<td style="text-align: center;"><span class="math inline">\(19.59 \pm 0.10\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.260 \pm 0.009\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">w/o H.</td>
<td style="text-align: center;"><span class="math inline">\(15.83 \pm 0.20\)</span></td>
<td style="text-align: center;"><span class="math inline">\(20.46 \pm 0.18\)</span></td>
<td style="text-align: center;"><span class="math inline">\(0.212 \pm 0.016\)</span></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="take-aways" class="level2">
<h2 class="anchored" data-anchor-id="take-aways">Take aways</h2>
<ul>
<li>A lot of machinery, but not a drastic improvement</li>
<li>It is the data, stupid! 😉 (It is not really clear how this is even supposed to work with information about the conditions)</li>
<li>Interestingly, they didn’t test USPTO or other datasets</li>
<li>Their approach with frozen encoders is interesting, it would have been interesting to see learning curves to better understand the data efficiency of the approach</li>
</ul>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Ahneman_2018" class="csl-entry" role="listitem">
Ahneman, Derek T., Jesús G. Estrada, Shishi Lin, Spencer D. Dreher, and Abigail G. Doyle. 2018. <span>“Predicting Reaction Performance in c–n Cross-Coupling Using Machine Learning.”</span> <em>Science</em> 360 (6385): 186–90. <a href="https://doi.org/10.1126/science.aar5169">https://doi.org/10.1126/science.aar5169</a>.
</div>
<div id="ref-Chen_2024" class="csl-entry" role="listitem">
Chen, Jiayuan, Kehan Guo, Zhen Liu, Olexandr Isayev, and Xiangliang Zhang. 2024. <span>“Uncertainty-Aware Yield Prediction with Multimodal Molecular Features.”</span> <em>Proceedings of the AAAI Conference on Artificial Intelligence</em> 38 (8): 8274–82. <a href="https://doi.org/10.1609/aaai.v38i8.28668">https://doi.org/10.1609/aaai.v38i8.28668</a>.
</div>
<div id="ref-Chuang_2018" class="csl-entry" role="listitem">
Chuang, Kangway V., and Michael J. Keiser. 2018. <span>“Comment on <span>‘Predicting Reaction Performance in c–n Cross-Coupling Using Machine Learning’</span>.”</span> <em>Science</em> 362 (6416). <a href="https://doi.org/10.1126/science.aat8603">https://doi.org/10.1126/science.aat8603</a>.
</div>
<div id="ref-gal2016dropout" class="csl-entry" role="listitem">
Gal, Yarin, and Zoubin Ghahramani. 2016. <span>“Dropout as a Bayesian Approximation: Representing Model Uncertainty in Deep Learning.”</span> In <em>International Conference on Machine Learning</em>, 1050–59. PMLR.
</div>
<div id="ref-jiang2024mixtral" class="csl-entry" role="listitem">
Jiang, Albert Q., Alexandre Sablayrolles, Antoine Roux, Arthur Mensch, Blanche Savary, Chris Bamford, Devendra Singh Chaplot, et al. 2024. <span>“Mixtral of Experts.”</span> <a href="https://arxiv.org/abs/2401.04088">https://arxiv.org/abs/2401.04088</a>.
</div>
<div id="ref-kingma2015variational" class="csl-entry" role="listitem">
Kingma, Diederik P., Tim Salimans, and Max Welling. 2015. <span>“Variational Dropout and the Local Reparameterization Trick.”</span> <a href="https://arxiv.org/abs/1506.02557">https://arxiv.org/abs/1506.02557</a>.
</div>
<div id="ref-Kwon_2022" class="csl-entry" role="listitem">
Kwon, Youngchun, Dongseon Lee, Youn-Suk Choi, and Seokho Kang. 2022. <span>“Uncertainty-Aware Prediction of Chemical Reaction Yields with Graph Neural Networks.”</span> <em>Journal of Cheminformatics</em> 14 (1). <a href="https://doi.org/10.1186/s13321-021-00579-z">https://doi.org/10.1186/s13321-021-00579-z</a>.
</div>
<div id="ref-schwaller2020data" class="csl-entry" role="listitem">
Schwaller, Philippe, Alain C Vaucher, Teodoro Laino, and Jean-Louis Reymond. 2020. <span>“Data Augmentation Strategies to Improve Reaction Yield Predictions and Estimate Uncertainty.”</span> <em>Chemrxiv Preprint</em>.
</div>
<div id="ref-schwaller2021prediction" class="csl-entry" role="listitem">
———. 2021. <span>“Prediction of Chemical Reaction Yields Using Deep Learning.”</span> <em>Machine Learning: Science and Technology</em> 2 (1): 015016.
</div>
<div id="ref-shazeer2017outrageously" class="csl-entry" role="listitem">
Shazeer, Noam, Azalia Mirhoseini, Krzysztof Maziarz, Andy Davis, Quoc Le, Geoffrey Hinton, and Jeff Dean. 2017. <span>“Outrageously Large Neural Networks: The Sparsely-Gated Mixture-of-Experts Layer.”</span> <a href="https://arxiv.org/abs/1701.06538">https://arxiv.org/abs/1701.06538</a>.
</div>
<div id="ref-vinyals2016order" class="csl-entry" role="listitem">
Vinyals, Oriol, Samy Bengio, and Manjunath Kudlur. 2016. <span>“Order Matters: Sequence to Sequence for Sets.”</span> <a href="https://arxiv.org/abs/1511.06391">https://arxiv.org/abs/1511.06391</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../papers/llm4mat.html" class="pagination-link" aria-label="Leveraging language representation for materials exploration and discovery">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Leveraging language representation for materials exploration and discovery</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../papers/dagdelen_data_extraction.html" class="pagination-link" aria-label="Structured information extraction from scientific text with large language models">
        <span class="nav-page-text"><span class="chapter-title">Structured information extraction from scientific text with large language models</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>